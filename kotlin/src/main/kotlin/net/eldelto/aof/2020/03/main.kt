package net.eldelto.aof.`2020`.`03`

fun main() {
  val slope = Point(3, 1)

  // Example
  val exampleMap = Map.parse(exampleInput)
  println("Example result: " + traverseMap(exampleMap, slope))

  // Scenario 1
  val map = Map.parse(input)
  println("Scenario 1 result: " + traverseMap(map, slope))

  // Scenario 2
  val slopes = listOf(
    Point(1, 1),
    Point(3, 1),
    Point(5, 1),
    Point(7, 1),
    Point(1, 2),
  )

  val result = slopes.map { traverseMap(map, it) }
    .reduce{ a, b -> a*b}
  println("Scenario 2 result: $result")
}

fun traverseMap(map: Map, slope: Point): Int {
  var treeCount = 0

  var point = slope
  while(true) {
    when(map.getTileAt(point)) {
      Tile.TREE -> treeCount++
      Tile.OUT -> break
    }
    point = point.add(slope)
  }

  return treeCount
}

enum class Tile {
  EMPTY, TREE, OUT;

  companion object {
    fun parse(c: Char): Tile = if (c == '.') EMPTY else TREE
  }
}

data class Point(val x: Int, val y: Int) {
  fun add(other: Point): Point {
    return Point(x + other.x, y + other.y)
  }
}

typealias MapRow = List<Tile>

class Map(private val data: List<MapRow>) {
  private val height = data.size
  private val width = if (data.isNotEmpty()) data[0].size else 0

  fun getTileAt(point: Point): Tile {
    if (point.y >= height) return Tile.OUT

    val x = if (point.x < width) point.x else point.x % width

    return data[point.y][x]
  }

  companion object {
    fun parse(rawData: String): Map {
      val data = rawData.split("\n")
        .map { it.map(Tile::parse) }

      return Map(data)
    }
  }
}

val exampleInput = """
  ..##.......
  #...#...#..
  .#....#..#.
  ..#.#...#.#
  .#...##..#.
  ..#.##.....
  .#.#.#....#
  .#........#
  #.##...#...
  #...##....#
  .#..#...#.#
""".trimIndent()

val input = """
  .............#...#....#.....##.
  .#...##.........#.#.........#.#
  .....##......#.......#.........
  .......#...........#.#.........
  #...........#...#..#.#......#..
  .........##....#.#...#.........
  .....#.........#.#...........#.
  ....#...............##....##...
  #.#.............#..#.......#.#.
  ...#...........................
  ......#..#....#.............#..
  ........#......#.......#.......
  ....#.....#..#.#...#.........#.
  ..#.#.......#.##...#....#.....#
  ...........#.........#..#......
  #...........#.#..#...#.#.#....#
  ........#......................
  ....#.#.....#....#.......#..#..
  .............................#.
  ....##..........#.....##......#
  ......#.....................#..
  ..#.....##.......#.............
  ....#.#..............#.#.......
  ..#.#........#.....#..##.......
  .....#...##.........##....#.#..
  .#....#..#..#...........#......
  .............#.....##........#.
  ..#....#............#.........#
  ###..........#........#.......#
  #...#..#.#.#.........#..#......
  ..#....#......#.............#..
  #...#........#..#...#.....#....
  .#..........#.#........#.......
  #.....#.........#..#......#....
  ....#....##........#......#....
  .......#....#.....#..#..#.....#
  .........#...#.#...#.##........
  .##.##...........#..##..#......
  .#.##....#........#...#........
  .......##.........##.####.....#
  ....#..##....#.................
  .#........#..........#.........
  ##....##..........##........#..
  #......#...........#....#..#...
  .......#..#....##..##.....#....
  .........#.#.#...#.....#.......
  ......#...#...#....#......#....
  ##....#..........#....##....##.
  ###.........#...#...#..........
  #.....##.#........#.......#....
  #...............#...##.#......#
  ..#.....####.###......#......#.
  ....#.......#..........#.......
  ....##..............#.#.#......
  .......##..#.......#...........
  ..#.......##....#.......###...#
  ........#...#.......#.#...#....
  .........##....#..#....#.......
  ............#.#.......#.#......
  .....#.....#...#....#.##.......
  .......#.........#.......#.....
  .#..#...#.....#............#.##
  .......#.#......##.............
  ##.#......#.....#.#............
  .#....#.....#............#...#.
  .........#.......#.#...........
  #............#.##...#..#...#.#.
  ......#....#.......#....#......
  ..........#........#..#.#......
  #..##.......#.........#..#.....
  .........#.....##........#.#..#
  ..#................#...........
  ....#..#........##.........#..#
  ###...#....##.#......##.......#
  .......#......##..#.......#....
  .......###...#...#..........##.
  ................#.......#......
  .#......##.##........#.........
  ....##.#.....##.......#........
  ...........#...........#.....#.
  ..#........#..#.#...#.#........
  #...............#...#.##.##.#.#
  ................#.......#......
  .#..#......#........#.#........
  ...##..#.......#.......#..#....
  .#.....#.#....##..#........#...
  ........##......#..........#...
  .#.......#.......#...#..#......
  .#..##.....#....#............#.
  ...#..........#....#........#..
  ..#.#..#.......#.#.##..........
  #........###.....#.#.......#.##
  .....#....##.............#.#..#
  ..##............#...##.........
  ...#.........#...........#.....
  ...#......#.#...#..###.........
  .............#...##............
  .....##..##.####.#..#......#.#.
  .#...#.....#.....#.#.....#.....
  .........#.......###.....#..##.
  .##.#..#..........#.##.#.#.....
  .#...#...#.#.##......#..#......
  .............#......#......#...
  #.....................#......#.
  ...#.....#.....#....#........#.
  ................##..#....#..#..
  #.###...#.....................#
  ...#..#....#.......#.........#.
  ...........#..#..#...........#.
  .......#..#......#....#.#......
  ..........#......#..#....#.....
  .#.#.....#...#.#...#...#.#....#
  .....#.......#............#...#
  #.#....#......#......#........#
  .#.#..#.........##...#.........
  #..###..#......................
  ..#.#..#.......................
  .##.....#...#......#..#........
  ...#...........#...#.......##..
  ..#...........#........#.......
  ........#....#.....#.#.........
  ..........#...........#.....#..
  ......#...#...##.#.............
  .#...#...##....................
  ............###.........#......
  .#.#...................#..#....
  ....#.#...#.#........#.#.......
  ....#...#...........#.......#.#
  ...........#............#...##.
  .....####....#.#......#.#......
  .##.............#............#.
  ......#.........#............##
  #.#....#...##....#.......#....#
  .....#.#....#..#..#...#..#.#..#
  .........................#.....
  ......#.#....###.......#....#..
  .....................##.#...#.#
  ..#.....#.#.#...#...#..........
  ........#..##........#...#...#.
  ..........#.#.##....#....##....
  .............#..#..............
  ..#.##..#.......#...#..#..##..#
  ..#..#....#.#..........#..#....
  ..........#....#...#......#....
  .##...#.......................#
  .#.....#....#..........#.......
  ...........#..#......##.....#..
  ......###.#..##....#...#.##....
  .......#..#.#....#.............
  ...#..#......##.........###.#..
  ...........#............##...#.
  ...#...#...........##.....#....
  ..................#............
  .#.#.#...#..............#..##..
  #.#....#........#.........#.##.
  #.#.#.......#.....#..........#.
  ...##.....##.#.....#...........
  .#....#..............##...##..#
  ........##.....................
  #..#..#.....###.............#..
  .......#...........#...........
  .........#.....................
  .......#...#...#.....##........
  ......#.........#........#.....
  ...#....##..#.####.#.......#.#.
  .....#..#......#........#.##..#
  .##....#......##......#...###..
  ..###.#........##.#...#.......#
  ............#......##....#.#...
  .....#....##..##............##.
  ......##....#.#...#....#.#..#.#
  .......#.........#.#.....#.#...
  .......#.#....#................
  .##...###..#.....#............#
  #.#......#.#..#..#.#...#..#..#.
  ..#.#.#.....#............#...##
  .##....###.........#..#........
  .#..#.#..#.#....#.........##.#.
  ....#..#...##.##........#......
  ........#.#....##....#....#....
  .......#..#..#.#..............#
  #....#....#.....#....#.........
  .#.###...#....#.......#........
  .........#.#....##....#...#....
  ....#.............#.....##.##..
  .....#.....#...##..#.#.##...##.
  .........#..#................##
  ...##..##......#.....#........#
  .#....#.....#.#......#..###....
  #.....#..#.....................
  ....#.#...#.#.................#
  .....##..................#.....
  #....##...#.##..###...#........
  ##.#.........#.......#....#....
  .#.#.............##..#.##......
  ...#.#..............#......#...
  .............#.........#.....#.
  #.......#........#......#.....#
  .....#..............#.##.#.....
  #......##...................#..
  ##.#.....#..........#........#.
  #...........##...........#.....
  .#...#.....#..#..##....#.......
  .....#.........#....##.#.......
  #........#......#.............#
  .#..................####.#.....
  #...#......#....##...#.#..#..#.
  ............#.#............#...
  ............#........#.#..###..
  .#..#..#..#.#.#.....#.#........
  #.....#..#.#...#..#..#........#
  #................#....#..#.....
  ....#..#..#.#......#.#..#.....#
  .#..#.......#...##.#.#.....#..#
  #.....................#.......#
  .............#.......#...#.....
  ....#......#.........###.##....
  ....#..#.......#.#........#....
  ....#...#....#.#....#..........
  ...#..#......#.............#...
  .......###.#.........#....#.#..
  ..#.....##.....................
  .#.#...........#..##....#......
  ..........##.#....#.#..........
  ...........#.#..#.#..#.#.......
  ..........#..#...#.....##......
  .....#.........#...#.#..#......
  #.#................#..........#
  ...#.....##.#..#...#.##.......#
  .....##...........#............
  .....#...#...#...#.#.....#.....
  ...........##..................
  .........#................#....
  ......#.....#.#...#.......#....
  ...#...#........#...#...#.#.#..
  ...............##..#....##...#.
  ...#.#...........##.......##..#
  ...........#............#......
  .#....#.#.......##.#.#.#.......
  .....#.#..#.#.#................
  .#............#...#.#..........
  .....#.......#.#.......#.....#.
  #....#...........#...#....##...
  ..#...#..##.....#....#..#......
  #.#.........#..#.#..#.#......#.
  ................#......##......
  #........#..............#....#.
  ........#..#.#........#..#..#..
  #..........#......#............
  ..##.......#..#.......#....#...
  .#........#..#..#.#.......##...
  ................#..............
  #.................#...........#
  ##..#...................#....##
  #..#....#.....#.#..#.#.#......#
  #................#.#.#...#.....
  .............#..#...#..##...#.#
  #..................#...........
  ..............#..#.....##.....#
  ..#...............#.#..........
  .....#......#....#..#...#......
  .#......#...##.....###.....#...
  ...##...##.##....#.#.#..#......
  ....#.#.......#..##....#.##....
  ...#.........#.#.....#...#...##
  .##.#.........##..#.##..#......
  .#...#......#......#.........#.
  .............#.................
  ..........#..............#.....
  ##...........#...#...###....#..
  ....#...............#..........
  .......####.....#......#.......
  ........#..........#..#........
  ..#.......#..#.................
  ......#.#..##...##....#........
  .##...#........#...#....#...#..
  .......................#.......
  .........##..#..#...#....##...#
  ..#..#...#.....#.........#..#..
  .......#....#.........#...#..#.
  .............#.................
  .....##..#.....###....##.#.....
  ....#.#..#..#.#.....##....#..#.
  ......#..#..............#.##..#
  ..#..#......#.#.........#..#...
  ..........#.#..#....#.....#....
  .....................#.........
  ...#.....#.......##..#.#.......
  .....#...#..........###....#.#.
  ......#.....##............#...#
  .......#..........#.#..#...#..#
  #...#..#...........#..##..#....
  .#......#.......##.....#..#....
  ...#..#....#.......##......#...
  ........#.......##...#.......#.
  .....#........#................
  ......#........#....#..........
  ...#....#....###.........#.#...
  ##..............#......#..#.#..
  .........##....#........#..#.#.
  .......#.##.#........#........#
  .....###..#..#...........#....#
  .......#....##.......#.#...#...
  #..............#.#....#..#...#.
  #..#....#..#.#............#..#.
  .#...##.#..................#...
  ...#...............##.........#
  ###..............#.#..#.#.#....
  .#......#.#.....##.......#.....
  ...#.................#.#.......
  .#...#....#...#..#......#...#..
  ...##....#........#.#.#..#.....
  ..#.....#........#....#.#......
  ...........#.#...#.............
  ......#.....#.....#.........#..
  .#.##.###...#.##.......#.......
  .............#....#.......#....
  ..............#...........#....
  .............#..#.#.....#....#.
  .......#........##...##..##....
  ..##...#............#..#......#
  .............#...##.....#......
  .#...##..##.#.........#.##...#.
""".trimIndent()
